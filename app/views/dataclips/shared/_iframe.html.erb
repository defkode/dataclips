<iframe scrolling='no' frameborder="no" allowfullscreen src='<%= src %>' width='<%= width %> ' height='<%= height %>' id='<%= id %>'></iframe>

<script>
var insightFilters = <%= filters.to_json.html_safe %>;
var filtersSet = false;

var frame = document.getElementById('<%= id %>');

$(frame).on("dataclips-refresh", function(){
  frame.contentWindow.postMessage({refresh: true}, "*");
});

$(frame).on("dataclips-fullscreen", function(){
  frame.contentWindow.postMessage({fullscreen: true}, "*");
});

window.addEventListener('message',
  function (e) {

    if (e.source === frame.contentWindow)
      $(frame).trigger("dataclips", e.data)

      if (e.data.percent_loaded === 100 && filtersSet === false) {
        frame.contentWindow.postMessage({filters: insightFilters}, "*");
        filtersSet = true;
      };
});
</script>
