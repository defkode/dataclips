<% content_for :title, clip_title(@clip) %>
  <script>
    Dataclips.config = {
      locale: '<%= I18n.locale %>',
      id: '<%= @clip_id %>',
      url: '<%= insight_path(@insight) %>',
      schema: <%= raw @schema.to_json %>,
      headers: <%= raw @headers.to_json %>,
      variables: <%= raw @variables.to_json %>
    };

    $(window).resize(function(){
      $("#grid").height($(window).height() - 120);
    });

    $(document).ready(function(){
      $(window).trigger("resize");
      Dataclips.run();
    });
  </script>


<div class="panel panel-default" id="dataclip">
  <div class="panel-heading">
    <div class="row">
      <div class="col-lg-9">
        <h4>
          <%= clip_title(@clip) %>
        </h4>
        <span class="count">0</span> / <span class="total_entries">0</span>
      </div>
      <div class="col-lg-3">
       <a class="btn btn-primary" href="<%= export_insight_path(@insight, format: :csv) %>">
         <span class="fa fa-download"></span> CSV
       </a>
      </div>
    </div>
  </div>
  <div class="panel-body">
    <div class="row">
      <div class="col-lg-9">
        <div id="grid"></div>
      </div>
      <div class="col-lg-3">
        <div class="panel-group" id="accordion" role="tablist">
          <% @schema.each do |key, options| %>
            <% id = "#{@clip_id}_#{key}" %>
            <div class="panel panel-default">
              <div class="panel-heading" role="tab">
                <div class="row">
                <div class="col-md-10">
                  <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapse_<%= id %>" aria-controls="<%= id %>">
                    <%= @headers[key] %>
                  </a>
                  </h4>
                </div>
                <div class="col-md-2 text-right">
                  <button data-key="<%= key %>" class="reset btn btn-xs btn-default"><i class="fa fa-times"></i></button>
                </div>
              </div>

              </div>
              <div id="collapse_<%= id %>" class="panel-collapse collapse out" role="tabpanel">
                <div class="panel-body">
                  <div class="form-group">
                    <% if options[:type] == "text" %>
                      <%= render "text", key: key, id: id, dictionary: options[:dictionary] %>
                    <% end %>

                    <% if options[:type] == "datetime" %>
                      <%= render "datetime", key: key, id: id %>
                    <% end %>

                    <% if options[:type] == "date" %>
                      <%= render "date", key: key, id: id %>
                    <% end %>

                    <% if options[:type] == "time" %>
                      <%= render "time", key: key, id: id %>
                    <% end %>

                    <% if options[:type] == "integer" %>
                      <%= render "integer", key: key, id: id %>
                    <% end %>

                    <% if options[:type] == "float" %>
                      <%= render "float", key: key, id: id %>
                    <% end %>

                    <% if options[:type] == "boolean" %>
                      <%= render "boolean", key: key, id: id %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>


          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="modal"></div>
<canvas id="progress" width="240" height="240"></canvas>

<%= javascript_include_tag "twitter/bootstrap" %>

